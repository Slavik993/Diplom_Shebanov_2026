using UnityEngine;
using TMPro;
using UnityEngine.UI;

public class LLMUIBinder : MonoBehaviour
{
    public UIDynamicBuilder builder;
    public LLMPrototypeController controller;

    void Start()
    {
        builder = FindObjectOfType<UIDynamicBuilder>();
        controller = FindObjectOfType<LLMPrototypeController>();

        if (builder == null || controller == null)
        {
            Debug.LogError("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω UIDynamicBuilder –∏–ª–∏ LLMPrototypeController!");
            return;
        }

        builder.npcGenerateButton.onClick.AddListener(OnGenerateClicked);
    }

    void OnGenerateClicked()
    {
        string name = builder.npcNameField.text;
        string environment = builder.npcEnvironmentField.text; // üÜï
        string relation = builder.npcRelationDropdown.options[builder.npcRelationDropdown.value].text;
        string emotion = builder.npcEmotionDropdown.options[builder.npcEmotionDropdown.value].text;
        string reaction = builder.npcReactionField.text;

        // –°–æ–∑–¥–∞—ë–º JSON –∏–∑ –¥–∞–Ω–Ω—ã—Ö UI
        string inputJson = $@"{{
    ""playerAction"": ""refuse"",
    ""npcState"": ""{relation}"",
    ""context"": {{
        ""location"": ""{environment}"",
        ""relationship"": ""{relation}""
    }},
    ""emotion"": ""{emotion}"",
    ""reactionLevel"": {reaction}
}}";

        Debug.Log($"[LLMUIBinder] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º JSON –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:\n{inputJson}");

        string dialogue = controller.GenerateDialogueFromJSON(inputJson);
        builder.npcDialogueText.text = dialogue;
    }
}
